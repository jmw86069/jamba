<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Remove outlier points per row by MAD factor threshold — rowRmMadOutliers • jamba</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Remove outlier points per row by MAD factor threshold — rowRmMadOutliers"><meta property="og:description" content="Remove outlier points per row by MAD factor threshold"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jamba</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.82.900</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/jamba-vignette.html">Jamba Overview</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="http://github.com/jmw86069/jamba/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Remove outlier points per row by MAD factor threshold</h1>
    <small class="dont-index">Source: <a href="http://github.com/jmw86069/jamba/blob/HEAD/R/jamba-rowgroupmeans-madoutliers.R" class="external-link"><code>R/jamba-rowgroupmeans-madoutliers.R</code></a></small>
    <div class="hidden name"><code>rowRmMadOutliers.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Remove outlier points per row by MAD factor threshold</p>
    </div>

    <div class="ref-usage sourceCode"><pre class="sourceCode r"><code><span class="fu">rowRmMadOutliers</span><span class="op">(</span>
  <span class="va">x</span>,
  madFactor <span class="op">=</span> <span class="fl">5</span>,
  na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
  minDiff <span class="op">=</span> <span class="fl">0</span>,
  minReps <span class="op">=</span> <span class="fl">3</span>,
  includeAttributes <span class="op">=</span> <span class="cn">FALSE</span>,
  rowMadValues <span class="op">=</span> <span class="cn">NULL</span>,
  verbose <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">...</span>
<span class="op">)</span></code></pre></div>

    <div id="ref-sections">
    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>numeric matrix</p></dd>
<dt>madFactor</dt>
<dd><p><code>numeric</code> value to multiply by each row MAD
to define the threshold for outlier detection.</p></dd>
<dt>na.rm</dt>
<dd><p><code>logical</code> indicating whether to ignore NA values
when calculating the MAD value. It should probably always be
<code>TRUE</code>, however setting to <code>FALSE</code> will prevent any
calculations in rows that contain <code>NA</code> values, which could
be useful.</p></dd>
<dt>minDiff</dt>
<dd><p><code>numeric</code> value indicating the minimum difference
from median to qualify as an outlier. This value protects
against removing outliers which are already extremely
similar. Consider this example:</p><ul><li><p>Three numeric values: <code>c(10.0001, 10.0002, 10.001)</code>.</p></li>
<li><p>The third value differs from median by only 0.0008.</p></li>
<li><p>The third value <code>10.001</code> is 5x MAD factor away from median.</p></li>
<li><p><code>minDiff = 0.01</code> would require the minimum difference from
median to be at least 0.01 to be eligible to be an outlier point.</p></li>
</ul></dd>
<dt>minReps</dt>
<dd><p><code>numeric</code> minimum number of non-NA values per row
for outliers to be filtered on the row. This argument is typically
only relevant for rows with <code>n=2</code> non-NA values, and when
<code>rowMadValues</code> is supplied and may define a threshold less than
half the difference in the two points on the given row.
Otherwise, n=2 defines each point at exactly 1x MAD from median,
and would therefore never be considered an outlier.</p></dd>
<dt>includeAttributes</dt>
<dd><p><code>logical</code> indicating whether to return
attributes that describe the threshold and type of threshold
used per row, in addition to the madFactor and minDiff values
defined.</p></dd>
<dt>rowMadValues</dt>
<dd><p><code>numeric</code> optional set of row MAD values to use,
which is mostly helpful when combining MAD values across multiple
samples groups on each row of data, where the combined MAD values
may be more reliable than individual group MAD values.</p></dd>
<dt>verbose</dt>
<dd><p><code>logical</code> indicating whether to print verbose output.</p></dd>
<dt>...</dt>
<dd><p>additional parameters are ignored.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A numeric matrix is returned, with the same dimensions
as the input <code>x</code> matrix. Outliers are replaced with <code>NA</code>.
If <code>includeAttributes=TRUE</code> then attributes will be
included:</p><ul><li><p><code>outlierDF</code> which is a <code>data.frame</code> with colnames</p><ul><li><p>rowMedians: <code>numeric</code> median on each row</p></li>
<li><p>rowMadValues: <code>numeric</code> MAD for each row</p></li>
<li><p>rowThresholds: <code>numeric</code> threshold after applying <code>madFactor</code> and
<code>minDiff</code></p></li>
<li><p>rowReps: <code>integer</code> number of non-NA values in the input data</p></li>
<li><p>rowTypes: <code>factor</code> indicating the type of threshold: <code>"madFactor"</code>
means the row applied the normal <code>MAD * madFactor</code> threshold;
<code>"minDiff"</code> means the row applied the <code>minDiff</code> threshold which
was the larger threshold.</p></li>
</ul></li>
<li><p><code>minDiff</code> with the <code>numeric</code> value supplied</p></li>
<li><p><code>madFactor</code> with the <code>numeric</code> MAD factor threshold supplied</p></li>
<li><p><code>outliersRemoved</code> with the <code>integer</code> total number of new NA values
produced by the outlier removal process.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function applies outlier detection and removal per
row of the input numeric matrix.</p><ul><li><p>It first calculates MAD per row.</p></li>
<li><p>The MAD threshold cutoff is a multiple of the MAD value,
defined by <code>madFactor</code>, multiplying the per-row MAD by the
<code>madFactor</code>.</p></li>
<li><p>The absolute difference from median is calculated for each
point.</p></li>
<li><p>Outlier points are defined:</p><ol><li><p>Points with MAD above the MAD threshold, and</p></li>
<li><p>Points with difference from median at or above <code>minDiff</code></p></li>
</ol></li>
</ul><p>The <code>minDiff</code> parameter affects cases such as 3 replicates,
where all replicates are well within a known threshold
indicating low variance, but where two replicates might
be nearly identical. Consider:</p><ul><li><p>Three numeric values: <code>c(10.0001, 10.0002, 10.001)</code>.</p></li>
<li><p>The third value differs from median by only 0.0008.</p></li>
<li><p>The third value <code>10.001</code> is 5x MAD factor away from median.</p></li>
<li><p><code>minDiff = 0.01</code> would require the minimum difference from
median to be at least 0.01 to be eligible to be an outlier point.</p></li>
</ul><p>One option to define <code>minDiff</code> from the data is to use:
<code>minDiff &lt;- median(rowMads(x))</code></p>
<p>In this case, the threshold is defined by the median difference
from median across all rows.
This type of threshold will only be reasonable if the variance
across all rows is expected to be fairly similar.</p>
<p>This function is substantially faster when the
<code>matrixStats</code> package is installed, but will use the
<code>apply(x, 1, mad)</code> format as a last option.</p><div class="section">
<h3 id="assumptions">Assumptions<a class="anchor" aria-label="anchor" href="#assumptions"></a></h3>

<ol><li><p>This function assumes the input data is appropriate for
the use of MAD as a summary statistic.</p></li>
<li><p>Specifically, numeric values per row are expected to be roughly
normally distributed.</p></li>
<li><p>Outlier points are assumed to be present in less than half overall
non-NA data.</p></li>
<li><p>Outlier points are assumed to be technical outliers, and therefore
not the direct result of the experimental measurements being studied.
Technical outliers are often caused by some instrument measurement,
methodological failure, or other upstream protocol failure.</p></li>
</ol><p>The default threshold of 5x MAD factor is a fairly lenient
criteria, above which the data may even be assumed not to conform
to most downstream statistical techniques.</p>
<p>For measurements considered to be more robust, or required to be more
robust, the threshold 2x MAD is applied. This criteria is usually a
reasonable expectation of housekeeper gene expression across replicates
within each sample group.</p>
</div>

    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other jam numeric functions: 
<code><a href="deg2rad.html">deg2rad</a>()</code>,
<code><a href="fix_matrix_ratio.html">fix_matrix_ratio</a>()</code>,
<code><a href="noiseFloor.html">noiseFloor</a>()</code>,
<code><a href="normScale.html">normScale</a>()</code>,
<code><a href="rad2deg.html">rad2deg</a>()</code>,
<code><a href="rowGroupMeans.html">rowGroupMeans</a>()</code>,
<code><a href="warpAroundZero.html">warpAroundZero</a>()</code></p></div>
    </div>
    </div>

    <div id="examples">
    <h2>Examples</h2>
    <div class="ref-examples sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>;</span>
<span class="r-in"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>ncol<span class="op">=</span><span class="fl">5</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="fl">5</span> <span class="op">+</span> <span class="fl">10</span>;</span>
<span class="r-in"><span class="co">## Define some outlier points</span></span>
<span class="r-in"><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,<span class="fl">3</span><span class="op">]</span><span class="op">*</span><span class="fl">5</span> <span class="op">+</span> <span class="fl">50</span>;</span>
<span class="r-in"><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="fl">5</span> <span class="op">-</span> <span class="fl">100</span>;</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">letters</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>;</span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">rowRmMadOutliers</span><span class="op">(</span><span class="va">x</span>, madFactor<span class="op">=</span><span class="fl">5</span><span class="op">)</span>;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        [,1]      [,2]      [,3]       [,4]     [,5]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a  7.197622 18.575325        NA 18.9345657 4.660881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b  8.849113        NA        NA 12.4892524 8.910125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c 17.793542        NA 12.003857  0.1669142 4.869978</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d 10.352542  6.565736 10.553414 13.5067795 6.355544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e 10.646439  7.771690  7.220794  7.6360430 6.874804</span>
<span class="r-in"></span>
<span class="r-in"><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu">rowRmMadOutliers</span><span class="op">(</span><span class="va">x</span>, madFactor<span class="op">=</span><span class="fl">2</span>,</span>
<span class="r-in">   includeAttributes<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>;</span>
<span class="r-in"><span class="va">x2</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        [,1]      [,2]      [,3]       [,4]     [,5]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a  7.197622 18.575325        NA 18.9345657 4.660881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b  8.849113        NA        NA 12.4892524 8.910125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c 17.793542        NA 12.003857  0.1669142 4.869978</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d 10.352542  6.565736 10.553414 13.5067795 6.355544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e        NA  7.771690  7.220794  7.6360430 6.874804</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"outlierDF")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   rowMedians rowMadValues rowThresholds rowReps  rowTypes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a  18.575325   16.8685827     33.737165       5 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b   8.910125    5.3064136     10.612827       5 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c   4.869978   10.5766897     21.153379       5 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d  10.352542    4.6764726      9.352945       5 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e   7.636043    0.6156476      1.231295       5 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"minDiff")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"madFactor")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"outliersRemoved")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 5</span>
<span class="r-in"></span>
<span class="r-in"><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu">rowRmMadOutliers</span><span class="op">(</span><span class="va">x2</span>,</span>
<span class="r-in">   madFactor<span class="op">=</span><span class="fl">2</span>,</span>
<span class="r-in">   rowMadValues<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x2</span>, <span class="st">"outlierDF"</span><span class="op">)</span><span class="op">$</span><span class="va">rowMadValues</span>,</span>
<span class="r-in">   includeAttributes<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>;</span>
<span class="r-in"><span class="va">x3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        [,1]      [,2]      [,3]       [,4]     [,5]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a  7.197622 18.575325        NA 18.9345657 4.660881</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b  8.849113        NA        NA 12.4892524 8.910125</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c 17.793542        NA 12.003857  0.1669142 4.869978</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d 10.352542  6.565736 10.553414 13.5067795 6.355544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e        NA  7.771690  7.220794  7.6360430 6.874804</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"outlierDF")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   rowMedians rowMadValues rowThresholds rowReps  rowTypes</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> a  12.886473   16.8685827     33.737165       4 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> b   8.910125    5.3064136     10.612827       3 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> c   8.436918   10.5766897     21.153379       4 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d  10.352542    4.6764726      9.352945       5 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> e   7.428419    0.6156476      1.231295       4 madFactor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"minDiff")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"madFactor")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> attr(,"outliersRemoved")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0</span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by James M. Ward.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 1.9000.9000.9000.</p>
</div>

      </footer></div>

  


  

  </body></html>

